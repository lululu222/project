<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>商品详情页</title>
    <link rel="stylesheet" href="../libs/iconfont/iconfont.css">
    <link rel="stylesheet" href="../css/reset.css">
    <link rel="stylesheet" href="../css/goodsdetail.css">

</head>

<body>
    <!-- 顶部小导航 -->
    <div class="s_top">
        <div class="container clearfix">
            <ul class="left">
                <li>
                    <i class="iconfont t">&#xe697;</i>
                    送至：
                    <span class="area">上海</span>
                    <i class="iconfont drop">&#xe60a;</i>
                    <!-- 鼠标经过 .drop时再显示 -->
                    <div class="dropdown">
                        <p class="title">请选择所在地区</p>
                        <div class="dropcity clearfix">
                            <label for="">热门省市</label>
                            <span>北京</span>
                            <span>上海</span>
                            <span>天津</span>
                            <span>江苏省</span>
                            <span>浙江省</span>
                            <span>山东省</span>
                            <span>河北省</span>
                            <span>福建省</span>
                        </div>
                        <div class="dropcity clearfix">
                            <label for="">华东</label>
                            <span>上海</span>
                            <span>江苏省</span>
                            <span>浙江省</span>
                            <span>山东省</span>
                            <span>江西省</span>
                            <span>安徽省</span>
                            <span>福建省</span>
                        </div>
                        <div class="dropcity clearfix">
                            <label for="">华南</label>
                            <span>广东省</span>
                            <span>海南区</span>
                            <span>广西区</span>
                        </div>
                        <div class="dropcity clearfix">
                            <label for="">华北</label>
                            <span>北京</span>
                            <span>内蒙古</span>
                            <span>天津</span>
                            <span>河北省</span>
                            <span>山西省</span>
                        </div>
                    </div>
                </li>
                <li>
                    <a href="" class="s_login">登录</a>
                    <span>|</span>
                    <a href="" class="s_register">注册</a>
                </li>
                <li>
                    <i class="iconfont">&#xe61e;</i>
                    我的订单
                </li>
                <li>
                    <i class="iconfont">&#xe65a;</i>
                    收藏本站(Ctrl+D)
                </li>
            </ul>
            <ul class="right">
                <li class="firstli">
                    <i class="iconfont">&#xe641;</i>
                    手机APP
                    <div class="dropdown_p">
                        <div class="dropdown_c clearfix">
                            <div class="item-qrcode">
                                <img src="http://www.lyzb.com/global/images/index2.0/qrcode-1.jpg"
                                    style="height:75px;width:75px">
                            </div>
                            <div class="item-info">
                                <p>集食惠手机客户端</p>
                                <p class="fc-red">手机下单，更多方便、实惠</p>
                                <div>
                                    <img src="http://www.lyzb.com/global/images/index2.0/thumb-iPhone.jpg">
                                    <img src="http://www.lyzb.com/global/images/index2.0/thumb-android.jpg">
                                </div>
                            </div>
                        </div>
                        <div class="dropdown_c clearfix">
                            <div class="item-qrcode">
                                <img src="http://www.lyzb.com/global/images/index2.0/qrcode-1.jpg"
                                    style="height:75px;width:75px">
                            </div>
                            <div class="item-info">
                                <p>集食惠手机网页版</p>
                                <p class="fc-red">手机下单，更多方便、实惠</p>
                                <div>
                                    <img src="http://www.lyzb.com/global/images/index2.0/thumb-iPhone.jpg">
                                    <img src="http://www.lyzb.com/global/images/index2.0/thumb-android.jpg">
                                    <img src="http://www.lyzb.com/global/images/index2.0/thumb-ipad.jpg">
                                </div>
                            </div>
                        </div>
                    </div>
                </li>
                <li class="uli">
                    帮助中心
                    <i class="iconfont">&#xe60a;</i>
                    <div class="drop_u">
                        <a href=""><span>售货服务</span></a>
                        <a href=""><span>会员介绍</span></a>
                        <a href=""><span>支付方式</span></a>
                    </div>
                </li>
                <li>
                    我要兑换
                    <i class="iconfont">&#xe84f;</i>
                </li>
                <li>
                    <i class="iconfont">&#xe634;</i>
                    商家中心
                </li>
            </ul>
        </div>
    </div>
    <!-- 中间logo部分 -->
    <div class="logo">
        <div class="container">
            <img src="http://www.lyzb.com/global/images/index2.0/logo.png" alt="">
            <div class="box">
                <div class="top clearfix">
                    <i class="iconfont mig">&#xe631;</i>
                    <input type="text" placeholder="搜索" name="" id="search">
                    <span>搜索</span>
                </div>
                <div class="bottom clearfix">
                    <a href="">热搜:</a>
                    <a href="">大闸蟹</a>
                    <a href="">蛋卷</a>
                    <a href="">牛奶</a>
                    <a href="">大米</a>
                    <a href="">鸡汤</a>
                    <a href="">食用油</a>
                    <a href="">米粉</a>
                </div>
            </div>
            <div class="shopcar">
                <a href="car.html">
                    <i class="iconfont">
                        &#xe726;
                        <span id="carcount">0</span>
                    </i>
                    <span class="text">我的购物车&gt;</span>

                </a>
            </div>

        </div>
    </div>


    <!-- 一级二级菜单 -->
    <div class="container">
        <div class="s_menu">
            <span>
                <a href="" class="num11">全部商品分类</a>
                <a href="index.html" class="num22 active">首页</a>
                <a href="list.html" class="num33">所有商品</a>
            </span>

        </div>
    </div>


    <!-- 商品详情内容部分1 -->
    <div class="goodscontent">
        <div class="container">
            <div class="goodsborder clearfix">
                <!-- 商品左侧 -->
                <div class="product_left">
                    <div class="imgleft">
                        <img id="imgbig" class="my-foto" src=" " data-large=" " title="Фото">
                    </div>
                    <div class="imgths clearfix">
                        <img id="imgsmall" src=" " alt="">
                    </div>
                    <div class="user_handle">
                        <div class="share">
                            <i class="iconfont">&#xe613;</i>分享
                        </div>
                    </div>
                </div>
                <!-- 商品右侧 -->
                <div class="product_right clearfix">
                    <div class="r_left">
                        <div class="product_name">
                            <h2 id="goodname"></h2>
                        </div>
                        <div class="product_information">
                            <div class="product_price">
                                <div class="price_border">价格：
                                    <span id="price"></span>
                                    <h4>销售价</h4>
                                </div>
                            </div>
                            <div class="x_detail">
                                <li>
                                    <div class="d_left">销量</div>
                                    <div class="d_right">已售出7件</div>
                                </li>
                                <li>
                                    <div class="d_left">配送至</div>
                                    <div class="d_right">上海宝山区</div>
                                </li>
                                <li>
                                    <div class="d_left">运费</div>
                                    <div class="d_right">￥0</div>
                                </li>
                            </div>
                            <div class="numb">

                                <div class="n_right">
                                    <input type="num" name="" id="">
                                </div>
                            </div>
                            <div class="goodbtn">
                                <input type="button" name="" id="" value="立即购买">
                                <input type="button" value="加入购物车" id="buycar">
                            </div>

                        </div>
                    </div>
                    <div class="r_right">
                        <div class="bar">
                            <h2>国冠直供店</h2>
                            <span>
                                <i class="iconfont">&#xe619;</i>
                                进店逛逛
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- 商品详情内容部分2 -->
    <div class="container">
        <div class="tab_info">
            <ul class="tab_title">
                <li>
                    <a href="">商品介绍</a>
                </li>
                <li>
                    <a href="">商品售后</a>
                </li>
            </ul>
            <div class="tab_cont">
                <div class="tab_cont_title">

                </div>
                <div class="tab_img">
                    <img id="imgdetail" src=" " alt="">
                </div>
            </div>
        </div>
    </div>



    <!--    这是底部使用jQuery的ajax请求的主页底部数据渲染 -->
    <div class="lastbottom">

    </div>


</body>
<script src="../libs/js/jquery.1.12.4.js"></script>
<script src="../libs/js/jquery-1.11.0.min.js"></script>
<script src="../libs/js/jquery.animate_from_to-1.0.js"></script>
<script src="../libs/js/zoomsl.min.js"></script>
<script src="../js/ajax.3.0.js"></script>
<script src="../js/cookie.js"></script>
<script>
    //ajax请求数据  load加载局部页面
    $(".lastbottom").load("public/bottom.html");



    // 放大镜
    jQuery(function () {

        $(".my-foto").imagezoomsl({

            zoomrange: [1, 6]
        });
    });

    //购物车
    cont = document.querySelectorAll(".cartext");

    $("#buycar").click(function () {
        $("#imgbig").animate_from_to("#carcount");
    })






    var topcount = document.getElementById("carcount");
    var buycar = document.getElementById("buycar");
    var goodsname = document.getElementById("goodname");
    var goodsprice = document.getElementById("price");
    // 要设置两个属性
    var goodsimgb = document.getElementById("imgbig");
    var goodsimgs = document.getElementById("imgsmall");
    //详情
    var detailimg = document.getElementById("imgdetail")
    onload = function () {
        var goodsid = window.location.href;
        //这是商品唯一标识性的id，在数据库中叫goodsId
        var id = goodsid.split("?")[1];
        //console.log(id);
        ajax({
            type: "get",
            url: "http://127.0.0.1/js%20project/project/data/goods.json",
            success: function (res) {
                var res = JSON.parse(res);
                for (var i = 0; i < res.length; i++) {
                    // console.log(res[i].goodsId);
                    if (res[i].goodsId == id) {
                        var Id = res[i].goodsId;
                        goodsimgb.setAttribute("src", `${res[i].img}`);
                        goodsimgb.setAttribute("data-large", `${res[i].img}`);
                        goodsimgs.setAttribute("src", `${res[i].img}`);
                        goodsname.innerHTML = `${res[i].title}`;
                        goodsprice.innerHTML = `${res[i].price}`;
                        detailimg.setAttribute("src", `${res[i].detail}`);

                        var msg = localStorage.getItem("loginUser");
                        //没有直接返回
                        if (msg == null) {
                           // alert("请先登录");
                            return;
                        };
                        //有，讲名字提取出来
                        var Lusername = JSON.parse(msg).user;
                        // 如果不为空证明有该用户的购物车
                        //console.log(getCookie(`${this.Lusername}`))
                        if ((getCookie(`${Lusername}`)) != "") {
                            t = JSON.parse(getCookie(`${Lusername}`));
                            topcount.innerHTML = `${t.length}`;
                        } else {
                            topcount.innerHTML = "0";
                        }

                        buycar.onclick = function () {
                            var msg = localStorage.getItem("loginUser");
                            //没有直接返回
                            if (msg == null) {
                                alert("请先登录");
                                return;
                            };
                            //var Id = goodsId;
                            thisgoods = getCookie(`${Lusername}`) ? JSON.parse(getCookie(`${Lusername}`)) : [];
                            //购物车为空直接存
                            if (thisgoods.length == 0) {
                                thisgoods.push({
                                    id: Id,
                                    num: 1
                                })
                            } else {
                                //购物车不为空，判断是新商品还是旧商品
                                var i = 0;
                                var onoff = thisgoods.some((val, index) => {
                                    i = index;
                                    return val.id == Id;
                                })
                                //旧商品增加数量
                                if (onoff) {
                                    thisgoods[i].num == thisgoods[i].num;
                                } else {
                                    //新商品直接存
                                    thisgoods.push({
                                        id: Id,
                                        num: 1
                                    })
                                }
                            }
                            //2.4最后设置cookie
                            setCookie(`${Lusername}`, JSON.stringify(thisgoods));
                            t = JSON.parse(getCookie(`${Lusername}`));
                            topcount.innerHTML = `${t.length}`;
                        }
                    }
                }
            }
        })




    }







</script>

</html>