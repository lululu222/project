<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="../libs/iconfont/iconfont.css">
    <link rel="stylesheet" href="../css/reset.css">
    <link rel="stylesheet" href="../css/list.css">

</head>

<body>
    <!-- 顶部小导航 -->
    <div class="s_top">
        <div class="container clearfix">
            <ul class="left">
                <li>
                    <i class="iconfont t">&#xe697;</i>
                    送至：
                    <span class="area">上海</span>
                    <i class="iconfont drop">&#xe60a;</i>
                    <!-- 鼠标经过 .drop时再显示 -->
                    <div class="dropdown">
                        <p class="title">请选择所在地区</p>
                        <div class="dropcity clearfix">
                            <label for="">热门省市</label>
                            <span>北京</span>
                            <span>上海</span>
                            <span>天津</span>
                            <span>江苏省</span>
                            <span>浙江省</span>
                            <span>山东省</span>
                            <span>河北省</span>
                            <span>福建省</span>
                        </div>
                        <div class="dropcity clearfix">
                            <label for="">华东</label>
                            <span>上海</span>
                            <span>江苏省</span>
                            <span>浙江省</span>
                            <span>山东省</span>
                            <span>江西省</span>
                            <span>安徽省</span>
                            <span>福建省</span>
                        </div>
                        <div class="dropcity clearfix">
                            <label for="">华南</label>
                            <span>广东省</span>
                            <span>海南区</span>
                            <span>广西区</span>
                        </div>
                        <div class="dropcity clearfix">
                            <label for="">华北</label>
                            <span>北京</span>
                            <span>内蒙古</span>
                            <span>天津</span>
                            <span>河北省</span>
                            <span>山西省</span>
                        </div>
                    </div>
                </li>
                <li>
                    <a href="login.html" class="s_login">登录</a>
                    <span>|</span>
                    <a href="register.html" class="s_register">注册</a>
                </li>
                <li>
                    <i class="iconfont">&#xe61e;</i>
                    我的订单
                </li>
                <li>
                    <i class="iconfont">&#xe65a;</i>
                    收藏本站(Ctrl+D)
                </li>
            </ul>
            <ul class="right">
                <li class="firstli">
                    <i class="iconfont">&#xe641;</i>
                    手机APP
                    <div class="dropdown_p">
                        <div class="dropdown_c clearfix">
                            <div class="item-qrcode">
                                <img src="http://www.lyzb.com/global/images/index2.0/qrcode-1.jpg"
                                    style="height:75px;width:75px">
                            </div>
                            <div class="item-info">
                                <p>集食惠手机客户端</p>
                                <p class="fc-red">手机下单，更多方便、实惠</p>
                                <div>
                                    <img src="http://www.lyzb.com/global/images/index2.0/thumb-iPhone.jpg">
                                    <img src="http://www.lyzb.com/global/images/index2.0/thumb-android.jpg">
                                </div>
                            </div>
                        </div>
                        <div class="dropdown_c clearfix">
                            <div class="item-qrcode">
                                <img src="http://www.lyzb.com/global/images/index2.0/qrcode-1.jpg"
                                    style="height:75px;width:75px">
                            </div>
                            <div class="item-info">
                                <p>集食惠手机网页版</p>
                                <p class="fc-red">手机下单，更多方便、实惠</p>
                                <div>
                                    <img src="http://www.lyzb.com/global/images/index2.0/thumb-iPhone.jpg">
                                    <img src="http://www.lyzb.com/global/images/index2.0/thumb-android.jpg">
                                    <img src="http://www.lyzb.com/global/images/index2.0/thumb-ipad.jpg">
                                </div>
                            </div>
                        </div>
                    </div>
                </li>
                <li class="uli">
                    帮助中心
                    <i class="iconfont">&#xe60a;</i>
                    <div class="drop_u">
                        <a href=""><span>售货服务</span></a>
                        <a href=""><span>会员介绍</span></a>
                        <a href=""><span>支付方式</span></a>
                    </div>
                </li>
                <li>
                    我要兑换
                    <i class="iconfont">&#xe84f;</i>
                </li>
                <li>
                    <i class="iconfont">&#xe634;</i>
                    商家中心
                </li>
            </ul>
        </div>
    </div>
    <!-- 中间logo部分 -->
    <div class="logo">
        <div class="container">
            <img src="http://www.lyzb.com/global/images/index2.0/logo.png" alt="">
            <div class="box">
                <div class="top clearfix">
                    <i class="iconfont mig">&#xe631;</i>
                    <input type="text" placeholder="搜索" name="" id="search">
                    <span>搜索</span>
                </div>
                <div class="bottom clearfix">
                    <a href="">热搜:</a>
                    <a href="">大闸蟹</a>
                    <a href="">蛋卷</a>
                    <a href="">牛奶</a>
                    <a href="">大米</a>
                    <a href="">鸡汤</a>
                    <a href="">食用油</a>
                    <a href="">米粉</a>
                </div>
            </div>
            <div class="shopcar">
                <a href="car.html">
                    <i class="iconfont">
                        &#xe726;
                        <span id="carcount">0</span>
                    </i>
                    <span class="text">我的购物车&gt;</span>

                </a>
            </div>

        </div>
    </div>


    <!-- 一级二级菜单 -->
    <div class="container">
        <div class="s_menu">
            <span>
                <a href="" class="num11">全部商品分类</a>
                <a href="index.html" class="num22 active">首页</a>
                <a href="list.html" class="num33">所有商品</a>
            </span>

        </div>
    </div>


    <!-- 列表内容部分 -->
    <div class="listscontent">
        <div class="container clearfix">
            <div class="c_left">
                <div class="hot">
                    热销商品
                </div>
                <div class="zuijin">
                    最近浏览
                </div>
            </div>
            <div class="c_right">
                <div class="product">
                    <div class="fn">
                        <a href="###">
                            销量
                            <i class="iconfont">&#xe60a;</i>
                        </a>
                        <a href="###">
                            价格
                            <i class="iconfont">&#xe60a;</i>
                        </a>
                        <a href="###">
                            最新
                            <i class="iconfont">&#xe60a;</i>
                        </a>
                    </div>
                </div>
                <div class="p_lists">
                    <ul id="goodslistbox">
                        <li>
                            <div class="goodimg">
                                <a href="">
                                    <img src="http://www.hangowa.com/data/upload/shop/store/goods/229/2019/229_06058844010817613_240.png"
                                        alt="">
                                </a>
                            </div>
                            <div class="goodcontent">
                                <div class="gname">
                                    <a href="">东北大米 十月稻田 寒露秋香长粒香米2.5kg</a>
                                </div>
                                <div class="gprice">
                                    <span class="now">￥29.0</span>
                                    <span class="before">￥39.0</span>
                                </div>
                            </div>
                        </li>
                       
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>



    <!--    这是底部使用jQuery的ajax请求的主页底部数据渲染 -->
    <div class="lastbottom"></div>
</body>
<script src="../libs/js/jquery.1.12.4.js"></script>
<script src="../js/ajax.3.0.js"></script>
<script src="../js/cookie.js"></script>
<script>
    $(".lastbottom").load("public/bottom.html");

    // 请求数据渲染页面
    class Lists {
        constructor() {
            //获取元素
            this.cont= document.querySelector("#goodslistbox");

            this.topcount=document.getElementById("carcount");
            //1.ajax请求数据，拿到数据渲染页面
            this.load();
            //2.绑定事件
            this.addEvent();
        }
        addEvent() {
            var that = this;
            //2.1通过事件监听绑定事件
            this.cont.addEventListener("click", function (eve) {
                if (eve.target.className == "carbtn") {
                    //2.2找到真正的点击元素，获取到具有唯一标示性的属性，存储到cookie中
                    that.id = eve.target.parentNode.getAttribute("qwe");
                    that.setCookie();
                    that.load();
                }
            })
        }
        setCookie() {
            //2.3规划数据格式并且判断该以什么方式存
            this.goods = getCookie("goods") ? JSON.parse(getCookie("goods")) : [];
            //购物车为空直接存
            if (this.goods.length == 0) {
                this.goods.push({
                    id: this.id,
                    num: 1
                })
            } else {
                //购物车不为空，判断是新商品还是旧商品
                var i = 0;
                var onoff = this.goods.some((val, index) => {
                    i = index;
                    return val.id == this.id;
                })
                //旧商品增加数量
                if (onoff) {
                    this.goods[i].num++;
                } else {
                    //新商品直接存
                    this.goods.push({
                        id: this.id,
                        num: 1
                    })
                }
            }
            //2.4最后设置cookie
            setCookie("goods", JSON.stringify(this.goods));
        }
        //1.1请求数据
        load() {
            var that = this;
            ajax({
                type:"post",
                url:"http://127.0.0.1/js%20project/project/data/goods.json",
                success:function(res){
                    that.res = JSON.parse(res);
                    //1.2拿到数据渲染页面
                     that.display();
                }
            })


        }
        display() {
            //1.3循环遍历，将数据插入到页面中
            var str = "";
            for (var i = 0; i < this.res.length; i++) {
                str += ` <li qwe="${this.res[i].goodsId}">
                            <div class="goodimg">
                                <a href="">
                                    <img src="${this.res[i].img}"
                                        alt="">
                                </a>
                            </div>
                            <div class="goodcontent">
                                <div class="gname">
                                    <a href="">${this.res[i].title}</a>
                                </div>
                                <div class="gprice">
                                    <span class="now">${this.res[i].price}</span>
                                    <span class="before">￥39.0</span>
                                </div>
                            </div>
                            <div class="carbtn">点击加入购物车</div>
                        </li>`;
            }
            this.cont.innerHTML = str;
            var carnum=JSON.parse(getCookie("goods")).length;
            this.topcount.innerHTML=carnum;

        }

    }
    new Lists();







</script>

</html>